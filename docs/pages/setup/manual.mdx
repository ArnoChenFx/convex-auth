import { Steps } from "nextra/components";

# Manual Setup

If you don't want the `npx @xixixao/convex-auth` command to make these changes
for you, or if it failed, follow these steps after you've installed the library.

<Steps>

### Configure SITE_URL

The `SITE_URL` environment variable is used when redirecting back to your site
during OAuth sign-in and for links sent via email.

[Setting environment variables Convex docs](https://docs.convex.dev/production/environment-variables#setting-environment-variables).

For local development you can run
`npx convex env set SITE_URL http://localhost:3000` (adjust the port number).

### Configure private and public key

Run the following script via `node generateKeys.mjs`:

```js filename="generateKeys.mjs"
import { exportJWK, exportPKCS8, generateKeyPair } from "jose";

const keys = await generateKeyPair("RS256");
const privateKey = await exportPKCS8(keys.privateKey);
const publicKey = await exportJWK(keys.publicKey);
const jwks = JSON.stringify({ keys: [{ use: "sig", ...publicKey }] });

process.stdout.write(
  `JWT_PRIVATE_KEY="${privateKey.trimEnd().replace(/\n/g, " ")}"`,
);
process.stdout.write("\n");
process.stdout.write(`JWKS=${jwks}`);
process.stdout.write("\n");
```

Copy the whole output and paste it into your Convex dashboard deployment's
[Environment Variables](https://dashboard.convex.dev/deployment/settings/environment-variables)
page.

You should now have two variables set up: `JWT_PRIVATE_KEY` and `JWKS`.

### Configure `auth.config.ts`

```ts filename="convex/auth.config.ts"
export default {
  providers: [
    {
      domain: process.env.CONVEX_SITE_URL,
      applicationID: "convex",
    },
  ],
};
```

### Initialize `auth.ts`

```ts filename="convex/auth.ts"
import { convexAuth } from "@xixixao/convex-auth/server";

export const { auth, signIn, signOut, store } = convexAuth({
  providers: [],
});
```

### Configure `http.ts`

```ts filename="convex/http.ts"
import { httpRouter } from "convex/server";
import { auth } from "./auth";

const http = httpRouter();

auth.addHttpRoutes(http);

export default http;
```

</Steps>
