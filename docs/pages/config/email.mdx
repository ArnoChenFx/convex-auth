import { Steps } from "nextra/components";
import { Aside } from "../../components/Aside";

# Magic Links

This authentication method has two steps:

1. The user provides an email, to which a link is sent
2. The user clicks on the link to reopen your web app and is signed-in

Your database keeps track of the issued link "token" that was sent which allows
for secure verification and expiration.

For React Native or to improve the user experience use the slightly more
advanced [OTP method](/config/email/otps).

## Email providers

Convex Auth implements configuration via [Auth.js](https://authjs.dev)
"provider" configs. These JS objects define how the library sends emails.

Open the
[Auth.js Magic Links providers doc](https://authjs.dev/getting-started/authentication/email)
to see a list of available email providers.

Choose an email provider (for example _Resend_) and follow the guide below.

_Ignore the "database provider" configuration in Auth.js docs. Your Convex
backend is your database!_

## Setup

<Steps>

### Environment variables

Configure the relevant environment variables for a given email provider, as per
Auth.js docs, on your Convex backend.

See
[setting environment variables Convex docs](https://docs.convex.dev/production/environment-variables#setting-environment-variables).

For example for _Resend_, after you sign up and obtain your API key, you can run
(with your own value):

```sh
npx convex env set AUTH_RESEND_KEY yourresendkey
```

### Provider configuration

Add the provider config to the `providers` array in `convex/auth.ts`.

Import Auth.js providers from `@auth/core/providers`. For example for _Resend_:

```ts filename="convex/auth.ts"
import Resend from "@auth/core/providers/resend";
import { convexAuth } from "@xixixao/convex-auth/server";

export const { auth, signIn, verifyCode, signOut, store } = convexAuth({
  providers: [Resend],
});
```

### Add sign-in form

Now you can trigger the email sending from a form submission via the Convex Auth
`signIn` function.

The first argument to the function is the provider ID, which unless customized
is a lowercase version of the provider name. For example for _Resend_:

```tsx filename="src/SignIn.tsx"
"use client";

import { useAuthActions } from "@xixixao/convex-auth/react";

export function SignIn() {
  const { signIn } = useAuthActions();
  return (
    <form
      onSubmit={(event) => {
        event.preventDefault();
        const formData = new FormData(event.currentTarget);
        void signIn("resend", formData);
      }}
    >
      <input name="email" placeholder="Email" type="text" />
      <button type="submit">Send sign-in link</button>
    </form>
  );
}
```

Check out the
[example repo](https://github.com/xixixao/convex-auth/blob/convex-auth-demo-src/app/auth/SignInFormEmailLink.tsx)
for a more polished UI.

</Steps>

When you're done configuring your chosen authentication methods, learn how to
use authentication in your frontend and backend in [Authorization](/authz).
